<!DOCTYPE html>
<html>
  <head>
    <title>Product Category Manipulation</title>
  <link rel="shortcut icon" href="images/favicon.ico">
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
      <style type="text/css">
      #container { padding:20px; border:1px solid #333; width:400px; }
       #list-template { display:none; }
      body {
        color: #222;
        font: 14px Arial;
      }
      
      body a {
        color: #3D5C9D;
        text-decoration: none;
      }
    </style>

  </head>
  <body onload="init();">

    <form method="post" onsubmit="addCategory(); return false;">
    
      <DIV>
      	<table>
      		<TR>
      		   <TD>      
      				<label id="SearchKey_lbl" >Search Key</label>
      			</TD>
      			<TD>      
      				<input type="text" id="SearchKey" name="inpSearchKey" placeholder="" style="width: 200px" />
      			</TD>
      		</TR>
      		<TR>
      		     <TD>      
      				<label id="SearchKey_lbl">Name</label>
      			</TD>
      			<TD>
	      			<input type="text" id="Name" name="inpName" placeholder="" style="width: 200px" />
    	  		</TD>
      		</TR>
      		<TR>

      			<TD>
      				<input type="submit" value="Add Product Category"/>
      			</TD>
      		</TR>
      	</table>
      </DIV>
    </form>
    
      
<div id="container">
    <ul id="list">    
    </ul>
</div>
 <div id="list-template">
	<li nowrap=true><span></span><a href=""></a></li>
</div>
    
    
  <script src="lib/BigDecimal-all-1.0.1.min.js"></script>
  <script src="lib/jquery-1.7.2.js"></script> 
  <script src="lib/underscore-1.3.3.js"></script> 
  <script src="lib/backbone-0.9.2.js"></script>  
     
  <script>
	  
     
  	  //Global Variables
  	  
  	  //Parent for all
      window.QUALIANOB = {};
      
  	  //handles webdb functions (open,user defined functions)
      window.QUALIANOB.webdb = {};
  	  
  	  //handles all db related functions
      window.QUALIANOB.webdb.db = null;
      
  	  //collects all models
      window.QUALIANOB.Model = window.QUALIANOB.Model || {};
      
      //collects all collections
      window.QUALIANOB.Collection = window.QUALIANOB.Collection || {};
      
      //collects all views
      window.QUALIANOB.View = window.QUALIANOB.View || {};
      
      
      //Create or Open the Database Connection      
      QUALIANOB.webdb.open = function() {
        var dbSize = 10 * 1024 * 1024; // 10MB
        QUALIANOB.webdb.db = openDatabase("WEBDB", "", "WEB DataBase", dbSize);
      }
      
	  //CreateProduct Category table in Web DB if it is not available.
	  
      QUALIANOB.webdb.createTable = function() {
        var db = QUALIANOB.webdb.db;
        var createQuery="CREATE TABLE IF NOT EXISTS M_Product_Category";
        createQuery=createQuery+"(m_product_category_id TEXT PRIMARY KEY ASC,ad_client_id TEXT,ad_org_id TEXT,isactive TEXT,created DATETIME,";
        createQuery=createQuery+"createdby TEXT,updated DATETIME,updatedby TEXT,value TEXT,name TEXT,description TEXT)";
        
        db.transaction(function(tx) {
          tx.executeSql(createQuery, []);
        });
      }

	  //Add record in Product Category in Web db and append it to list.
	  
      QUALIANOB.webdb.addProductCategory = function(searchKey,name) {
        var db = QUALIANOB.webdb.db;
        var insertQuery="INSERT INTO M_Product_Category (m_product_category_id,ad_client_id,ad_org_id,isactive,created, ";
        insertQuery=insertQuery+"createdby,updated,updatedby,value,name,description)";
        insertQuery=insertQuery+"VALUES (?,?,?,?,?,?,?,?,?,?,?)";
        db.transaction(function(tx){
          var addedOn = new Date();
          tx.executeSql(insertQuery,
              [get_uuid(),'0','0','Y',addedOn,'0',addedOn, '0',searchKey,name,name],
              QUALIANOB.webdb.appendItems,
              QUALIANOB.webdb.onError);
         });
      }

      //Error function 
      QUALIANOB.webdb.onError = function(tx, e) {
        alert("There has been an error: " + e.message);
      }
      
      //Append function called on success
      QUALIANOB.webdb.appendItems = function(tx, r) {
  	    var db = QUALIANOB.webdb.db;
	    db.transaction(function(tx) {
	      tx.executeSql("SELECT * FROM M_Product_Category Order by updated desc limit 1", [], loadTodoItems,
	    		  QUALIANOB.webdb.onError);
	    });
      }
     
      
    //Generate UUID
  	function S4() {
		return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1)
				.toUpperCase();
	}
	function get_uuid() {
		return (S4() + S4() + S4() + S4() + S4() + S4() + S4() + S4());
	}      
      
	//Add Product category 
      function addCategory() {    	 
        var SearchKey = document.getElementById("SearchKey");
        var Name = document.getElementById("Name");
        QUALIANOB.webdb.addProductCategory(SearchKey.value,Name.value);
        SearchKey.value = "";
        Name.value = "";
      }

	//Retrive the Product Category
	
      QUALIANOB.webdb.getAllTodoItems = function(renderFunc) {
	    var db = QUALIANOB.webdb.db;
	    db.transaction(function(tx) {
	      tx.executeSql("SELECT * FROM M_Product_Category", [], renderFunc,
	    		  QUALIANOB.webdb.onError);
	    });
	  }
	
	//Iterate Product Category values
	
      function loadTodoItems(tx, rs) {
          var rowOutput = "";
          var productCategorys=new window.QUALIANOB.Collection.ProductCategorys();
          for (var i=0; i < rs.rows.length; i++) {
            var row=rs.rows.item(i);
            
            var productCategory = new QUALIANOB.Model.ProductCategory();
            productCategory.set({href: row.name});
            productCategory.set({text: row.name});
            productCategory.set({m_product_category_id: row.m_product_category_id});
            productCategorys.add(productCategory,[]);
            
          }
          console.log(productCategorys.length);
          //Add to View
          var productCategoryView = new window.QUALIANOB.View.ProductCategoryView({ collection: productCategorys });
          productCategoryView.render();
        }
   
//On Load Method

function init() {
	
	//Creates the Web Db in Browser
    QUALIANOB.webdb.open();
	
	//Creates table if not available
    QUALIANOB.webdb.createTable();
	
	//Set empty values to input fields
    SearchKey = "";
    Name = "";
    
    //Loads the values from web DB
    QUALIANOB.webdb.getAllTodoItems(loadTodoItems);   

}


//Product Category Model

var ProductCategory = Backbone.Model.extend({
	urlRoot: "/api/ProductCategory",
	modelName:'ProductCategory',
	tableName:'m_product_category',
	entityName:'ProductCategory',
	initialize: function() {
    this.bind('error', function( model, error ) {
	   console.error(error);
	  }); 	
	},
	defaults: {
 
	},
	validate: function ( attributes ) {
	  
	}
});


//Product Category Collection

var ProductCategorys = Backbone.Collection.extend({
	 url: "/api/ProductCategory",
	 initialize: function() {
	 },
	 model: ProductCategory
});

window.QUALIANOB.Model.ProductCategory = ProductCategory;
window.QUALIANOB.Collection.ProductCategorys = ProductCategorys;

//Product Category View

var ProductCategoryView = Backbone.View.extend({
    el: '#container',
    initialize: function () {    	
        this.template = $('#list-template').children();
    },
    render: function() {
  	  for(var i=0;i<this.collection.length;i++){
        	var data = this.collection.at(i);
        	var href = "<a href='javascript:void(0);' id='"+data.get('m_product_category_id')+"'>[Delete]</a>";
        	var li = this.template.clone().find('span').text(data.get('text')).end()
        	.attr("id",data.get('m_product_category_id'))
        	.find('a').attr("id",data.get('m_product_category_id'))
        	.attr("href",'javascript:void(0);').attr("onclick","QUALIANOB.webdb.removeCategory(this.id)").text('[Delete]').end();
        	this.$el.find('ul').append(li);
  	  }
    }
});

window.QUALIANOB.View.ProductCategoryView=ProductCategoryView;


//Remove the product category
QUALIANOB.webdb.removeCategory = function(id) {    	  
  var db = QUALIANOB.webdb.db;  
  var productCategorys=new window.QUALIANOB.Collection.ProductCategorys();
  db.transaction(function(tx){
    tx.executeSql("DELETE FROM M_Product_Category WHERE M_Product_Category_id=?", [id],
    		QUALIANOB.webdb.onDeleteSuccess,
    		QUALIANOB.webdb.onError);
    });

  
}

//Append function called on success
QUALIANOB.webdb.onDeleteSuccess = function(tx, rs) {

    $("#container").find("ul").html('');
	QUALIANOB.webdb.getAllTodoItems(loadTodoItems);     

}

    </script>
    
  </body>
</html>â€‹